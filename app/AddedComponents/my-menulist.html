<link rel="import" href="../bower_components/polymer/polymer.html"/>
<link rel="import" href="./my-menu.html"/>
<link rel="import" href="./my-toolbar.html"/>
<link rel="import" href="../bower_components/iron-list/iron-list.html"/>
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"/>
<link rel="import" href="../bower_components/paper-item/paper-item.html"/>
<link rel="import" href="../bower_components/paper-item/paper-item-body.html"/>
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html"/>
<link rel="import" href="../bower_components/observe-js/observe-js.html"/>
<link rel="import" href="../bower_components/paper-button/paper-button.html"/>
<dom-module id="my-menulist">
    <style>
        :host{
            /*display: block;*/
        }
        #menuEntry{
            display: block;
            border: solid;
            width:60%;
            margin-left: 5px;
        }
        #addedEntry{
            display:block;
            height: inherit;
            border: solid;
            width: 37%;
            size: 100px;
            margin-left: 6px;

        }
        #removeButton{
            display: block;
            margin-left: 10px;
        }



        /*--------------------------------------*/
        /*NON USARE LE CAZZO DI MAIUSCOLE*/
        /*--------------------------------------*/


    </style>
    <template>
        <my-toolbar id="giuseppeToolbar" description="Nome Ristorante" menu-selected="{{menuSelected}}"> </my-toolbar>

        <div class="layout horizontal wrap">
            <div id="menuEntry">
                <!--<my-menu></my-menu>-->
                <iron-ajax url="./menus/{{menu}}.json" last-response="{{data}}" auto></iron-ajax>
                <iron-list id="itemsList" items="[[data]]" as="item" selection-enabled selected-item="{{selectedItem}}" on-click="_addMeal" >
                    <template >
                        <!--<paper-item on-tap="_unselect">-->
                        <paper-item>
                            <paper-item-body two-line  >
                                <div>
                                    Name: <span>[[item.name]]</span>
                                </div>
                                <div secondary>
                                    Description: <span>[[item.description]]</span>
                                </div>
                            </paper-item-body>
                        </paper-item>
                    </template>
                </iron-list>
            </div>

            <div id="addedEntry">
                <!--<template is="dom-repeat" id="orders" items="{{meals}}">-->

                    <iron-list id="orders" items="{{meals}}" as="meal" selection-enabled selected-item="{{selectedItem}}" on-click="_removeMeal">
                    <template on-tap="_unselect">
                    <paper-item>
                        <paper-item-body>
                            <span>[[meal.name]]</span>  <span>{{meal.ordered}}</span>
                        </paper-item-body>
                    </paper-item>
                    </template>
                    </iron-list>
                <!--</template>-->
            </div>


        </div>
    </template>


    <script>
        (function () {
            'use strict';
            Polymer({
                is: 'my-menulist',
                properties: {
                    menu: {
                        type: String,
                        value: 'package'
                    },
                    selectedItem:{
                        type: Object,
                        notify: true
                    },
                    meals: {
                        type: Array,
                        value: function() {return []},
                        notify: true

                    },
                    total:{
                        type:Number,
                        value:0,
                        notify:true
                    }
                },
                observers:[
                    '_menuSelectedChange(menuSelected)'
                ],

                changeMenu: function(newMenu) {
                    this.menu = newMenu
                },

//                _unselect :function(e){
//                    console.log("unselect");
//                    this.$.itemsList.clearSelection();
//                },

                _menuSelectedChange: function(e) {
                    console.log(e)
                    if(e==0){
                        this.menu="package";
                    }else if(e==1){
                        this.menu="secondi";
                    }else if(e==2){
                        this.menu="dolci";
                    }else if(e==3){
                        this.menu="bevande";
                    }
                },



                _addMeal :function(e){

                    var self=this;
                    var found=false;
                    var nameS=this.selectedItem.name;
                    for(var i in this.meals) {
                        if(this.meals[i].name == nameS) {
                            var meal="meals."+i+".ordered";
                            this.set(meal, this.meals[i].ordered + 1);
                            console.log(this.meals);
                            found = true;
                        }
                    }
                    if (found==false){
                        this.push('meals', {
                            name:this.selectedItem.name,
                            description:this.selectedItem.description,
                            ordered:1,
                        });}
                    this.$.itemsList.clearSelection();
                },

                _removeMeal :function(e){
                    console.log(e);
                    console.log('remove');
                    var self=this;
                    var mealS=this.selectedItem;
                    console.log("selectedToRemove",mealS);
                    for(var i in this.meals){
                        if (this.meals[i].name==mealS.name) {
                            if (this.meals[i].ordered>1){
                                var meal = "meals." + i + ".ordered";
                                this.set(meal,this.meals[i].ordered-1);
                            }
                            else{
                                this.splice('meals',i,1);
                            }
                        }
                    }
                    this.$.orders.clearSelection();

                }



            })
        })();
    </script>
</dom-module>